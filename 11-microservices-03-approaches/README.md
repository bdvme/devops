*Студент: Дмитрий Багрянский*

# Домашняя работа

## Урок 11.03 «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

* облачная система;
* система контроля версий Git;
* репозиторий на каждый сервис;
* запуск сборки по событию из системы контроля версий;
* запуск сборки по кнопке с указанием параметров;
* возможность привязать настройки к каждой сборке;
* возможность создания шаблонов для различных конфигураций сборок;
* возможность безопасного хранения секретных данных (пароли, ключи доступа);
* несколько конфигураций для сборки из одного репозитория;
* кастомные шаги при сборке;
* собственные докер-образы для сборки проектов;
* возможность развернуть агентов сборки на собственных серверах;
* возможность параллельного запуска нескольких сборок;
* возможность параллельного запуска тестов.

Обоснуйте свой выбор.

---
###### Ответ:

Gitlab-хранение кода + Gitlab CI/CD - соответствует всем требованиям выше, можно настроить Container Registry для docker-образов.

Gitlab-хранение кода + Jenkins CI/CD - так же соответствует всем требованиям выше, можно использовать Gitlab Container Registry.


## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

* сбор логов в центральное хранилище со всех хостов, обслуживающих систему;                                                                                                
* минимальные требования к приложениям, сбор логов из stdout;
* гарантированная доставка логов до центрального хранилища;
* обеспечение поиска и фильтрации по записям логов;
* обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
* возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

---
###### Ответ:

Я бы использовал ELK-стек.

Состав:

- Elasticsearch - обеспечивает горизонтально масштабируемый поиск, поддерживает многопоточность. Поисковые индексы можно разделить на сегменты, каждый сегмент может иметь несколько реплик, на каждом узле может быть размещено несколько сегментов, при том каждый узел действует как координатор для делегирования операций правильному сегменту, перебалансировка и маршрутизация выполняются автоматически. Связанные данные часто хранятся в одном и том же индексе, который состоит из одного или нескольких первичных сегментов и, возможно, нескольких реплик. После создания индекса количество первичных сегментов нельзя изменить     

- Logstash - служба для сбора, фильтрации и нормализации логов. Оно является бесплатным и open source приложением.      

- Kibana - Open Source web-инструмент для визуализации данных, позволяет управлять индексами Elasticsearch, выполнять непосредственный визуальный поиск, строить Dashbord-ы для удобства оперативного анализа логов (данных).    

- FileBeat - это легковесный доставщик лог-сообщений. Принцип его работы состоит в мониторинге и сборе лог-сообщений из лог-файлов и пересылке их в elasticsearch или logstash для индексирования..         


## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

* сбор метрик со всех хостов, обслуживающих систему;
* сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
* сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
* сбор метрик, специфичных для каждого сервиса;
* пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
* пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.         

Обоснуйте свой выбор.

---
###### Ответ:

Я выбрал бы стек Prometheus + Grafana + Node Exporter + Alertmanager. 

Состав:

- Prometheus -  СУБД хранения временных рядов, с возможностью построения графиков, настройки оповещений и работы с БД через язык запросов PromQL. Prometheus в отличие от других СУБД сам опрашивает хосты и забирает из них данные. Программы, которые снимают данные с хостов называются экспортёры. Самый востребованный из них — node exporter.

- Grafana — это гибкая система визуализации данных с web-интерфейсом, которая работает с десятками разнообразных баз данных: начиная от классических SQL баз данных, заканчивая базами данных временных рядов. Одной из самых популярных СУБД временных рядов является Prometheus.

- Node exporter — это маленькая программа, которая отслеживает метрики системы и предоставляет к ним доступ на порте 9100. Node exporter считывает огромное количество метрик, однако его можно настроить так, чтобы он передавал только нужные вам метрики. На базе полученных метрик строятся графики и формируются оповещения об инцидентах. Обычно для их обработки используют Alertmanager.

- Alertmanager — это программа, которая обрабатывает оповещения об инцидентах (алерты), которые формирует Prometheus на базе метрик, получаемых от node exporter. Alertmanager нужен для более гибкой работы с алертами. Он умеет объединять их в группы, работать с условиями и каналами их доставки. Вы можете получать алерты любым удобным для вас способом: начиная от электронной почты, заканчивая Telegram.